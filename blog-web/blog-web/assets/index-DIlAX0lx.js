import{u as i,d as s}from"./file-Dx1FRdn-.js";import{n as l,u as o,i as c,j as n,k as m,o as d}from"./index-05qZtuZM.js";import{g}from"./dict-Dpqj6rjX.js";const u={name:"Editor",data(){return{articleForm:{title:"",summary:"",content:"",contentMd:"",cover:"",keywords:"",isOriginal:1,originalUrl:"",categoryName:"",tags:[],status:""},rules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:5,max:100,message:"标题长度应在5-100个字符之间",trigger:"blur"}],summary:[{required:!0,message:"请输入文章描述",trigger:"blur"},{min:10,max:500,message:"描述长度应在10-500个字符之间",trigger:"blur"}],contentMd:[{required:!0,message:"请输入文章内容",trigger:"blur"},{validator:(a,e,t)=>{if(!e){t();return}if(e.length<50){t(new Error("文章内容至少需要50个字符"));return}if(/^[a-zA-Z]{10,}$/.test(e)){t(new Error("文章内容似乎没有实际意义，请认真编写"));return}t()},trigger:["blur","change"]}],cover:[{required:!0,message:"请上传封面图片",trigger:"change"}],categoryName:[{required:!0,message:"请选择文章分类",trigger:"change"}],tags:[{required:!0,message:"请选择文章标签",trigger:"change"},{validator:(a,e,t)=>{e.length>3?t(new Error("最多只能选择3个标签")):t()},trigger:"change"}],originalUrl:[{required:!0,message:"请输入原文地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],keywords:[{validator:(a,e,t)=>{e&&e.split(",").length>5?t(new Error("关键词最多不超过5个")):t()},trigger:"blur"}]},categories:[],tags:[],isSubmitting:!1,statusList:[]}},created(){n().then(a=>{this.categories=a.data}),m().then(a=>{this.tags=a.data}),g(["article_status"]).then(a=>{this.statusList=a.data}),this.articleForm.id=this.$route.query.id,this.articleForm.id&&d(this.articleForm.id).then(a=>{this.articleForm=a.data})},methods:{async saveDraft(){const a=this.statusList.filter(e=>{if(e.label==="草稿")return e.value});this.articleForm.status=a[0].value,await this.submitArticle()},async publishArticle(){const a=this.statusList.filter(e=>{if(e.label==="审核")return e});this.articleForm.status=a[0].value,await this.submitArticle()},submitArticle(){this.isSubmitting||this.$refs.articleForm.validate(a=>{if(!a)return;this.isSubmitting=!0,this.articleForm.content=this.$refs.mdRef.d_render,console.log(this.articleForm),(this.articleForm.id?o:c)(this.articleForm).then(t=>{this.$message.success("保存成功"),this.$router.push("/user/profile")}).catch(t=>{this.$message.error(t.message)}).finally(()=>{this.isSubmitting=!1})})},imgDel(a,e){console.log(a),s(a[0]).then(t=>{this.$refs.mdRef.$img2Url(a,"")})},imgAdd(a,e){const t=new FormData;t.append("file",e),i(t,"article-content").then(r=>{this.$refs.mdRef.$img2Url(a,r.data)})},triggerCoverUpload(){this.$refs.coverInput.click()},handleCoverUpload(a){const e=a.target.files[0];if(!e)return;const t=new FormData;t.append("file",e),i(t,"article-cover").then(r=>{r.code===200?(this.articleForm.cover=r.data,this.$message.success("上传成功")):this.$message.error(r.message||"上传失败")}).catch(r=>{this.$message.error("上传失败，请重试")}),a.target.value=""},removeCover(){this.articleForm.cover=""}}};var p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"editor-container"},[t("div",{staticClass:"editor-main"},[t("el-form",{ref:"articleForm",attrs:{model:e.articleForm,rules:e.rules,"label-position":"top",size:"small"}},[t("div",{staticClass:"editor-content"},[t("div",{staticClass:"content-card"},[t("div",{staticClass:"title-cover-layout"},[t("div",{staticClass:"title-section"},[t("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入文章标题..."},model:{value:e.articleForm.title,callback:function(r){e.$set(e.articleForm,"title",r)},expression:"articleForm.title"}})],1),t("el-form-item",{attrs:{label:"文章描述",prop:"summary"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入文章描述..."},model:{value:e.articleForm.summary,callback:function(r){e.$set(e.articleForm,"summary",r)},expression:"articleForm.summary"}})],1)],1),t("div",{staticClass:"cover-section"},[t("el-form-item",{attrs:{label:"封面图片",prop:"cover"}},[t("div",{staticClass:"cover-area",on:{click:e.triggerCoverUpload}},[e.articleForm.cover?t("div",{staticClass:"cover-preview"},[t("img",{attrs:{src:e.articleForm.cover,alt:"文章封面"}}),t("div",{staticClass:"cover-actions"},[t("el-button",{attrs:{size:"small",circle:"",type:"danger"},on:{click:function(r){return r.stopPropagation(),e.removeCover.apply(null,arguments)}}},[t("i",{staticClass:"fas fa-trash"})])],1)]):t("div",{staticClass:"cover-placeholder"},[t("i",{staticClass:"fas fa-image"}),t("span",[e._v("点击上传封面图")])])]),t("input",{ref:"coverInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.handleCoverUpload}})])],1)])]),t("div",{staticClass:"content-card flex-card"},[t("el-form-item",{staticClass:"mb-20",attrs:{label:"文章内容",prop:"contentMd"}},[t("mavon-editor",{ref:"mdRef",staticStyle:{height:"500px",width:"100%"},attrs:{placeholder:"输入文章内容...",previewBackground:"var(--card-bg)",toolbarsBackground:"var(--card-bg)",toolbarsBackgroundImage:"var(--card-bg)"},on:{imgDel:e.imgDel,imgAdd:e.imgAdd},model:{value:e.articleForm.contentMd,callback:function(r){e.$set(e.articleForm,"contentMd",r)},expression:"articleForm.contentMd"}})],1)],1)]),t("div",{staticClass:"editor-sidebar"},[t("div",{staticClass:"sidebar-section"},[t("h3",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-folder"}),e._v(" 文章分类 ")]),t("el-form-item",{attrs:{prop:"categoryId"}},[t("el-select",{attrs:{placeholder:"请选择分类"},model:{value:e.articleForm.categoryName,callback:function(r){e.$set(e.articleForm,"categoryName",r)},expression:"articleForm.categoryName"}},e._l(e.categories,function(r){return t("el-option",{key:r.id,attrs:{label:r.name,value:r.name}})}),1)],1)],1),t("div",{staticClass:"sidebar-section"},[t("h3",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-tags"}),e._v(" 文章标签 ")]),t("el-form-item",{attrs:{prop:"tagIds"}},[t("el-select",{attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择标签"},model:{value:e.articleForm.tags,callback:function(r){e.$set(e.articleForm,"tags",r)},expression:"articleForm.tags"}},e._l(e.tags,function(r){return t("el-option",{key:r.id,attrs:{label:r.name,value:r.name}})}),1)],1)],1),t("div",{staticClass:"sidebar-section"},[t("h3",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-cog"}),e._v(" 文章设置 ")]),t("div",{staticClass:"setting-item"},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-text":"原创文章"},model:{value:e.articleForm.isOriginal,callback:function(r){e.$set(e.articleForm,"isOriginal",r)},expression:"articleForm.isOriginal"}})],1),e.articleForm.isOriginal?e._e():t("div",{staticClass:"setting-item"},[t("div",{staticClass:"setting-label"},[e._v("转载地址：")]),t("el-form-item",{attrs:{prop:"originalUrl"}},[t("el-input",{attrs:{placeholder:"请输入原文地址",size:"small"},model:{value:e.articleForm.originalUrl,callback:function(r){e.$set(e.articleForm,"originalUrl",r)},expression:"articleForm.originalUrl"}})],1)],1),t("div",{staticClass:"setting-item"},[t("div",{staticClass:"setting-label"},[e._v("关键词：")]),t("el-form-item",{attrs:{prop:"keywords"}},[t("el-input",{attrs:{placeholder:"请输入关键词（多个用逗号隔开）",size:"small"},model:{value:e.articleForm.keywords,callback:function(r){e.$set(e.articleForm,"keywords",r)},expression:"articleForm.keywords"}})],1)],1)]),t("div",{staticClass:"sidebar-section"},[t("div",{staticClass:"setting-item"},[t("el-button",{attrs:{size:"small"},on:{click:e.saveDraft}},[t("i",{staticClass:"fas fa-save"}),e._v(" 保存草稿 ")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.publishArticle}},[t("i",{staticClass:"fas fa-paper-plane"}),e._v(" 提交审核 ")])],1)])])])],1)])},f=[],v=l(u,p,f,!1,null,"442b9c69");const C=v.exports;export{C as default};
