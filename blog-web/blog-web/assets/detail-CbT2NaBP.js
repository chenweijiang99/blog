import{n as i,v as o,a as l,b as n}from"./index-05qZtuZM.js";const c={name:"AlbumPasswordDialog",data(){return{visible:!1,loading:!1,form:{password:""},rules:{password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{show(){this.visible=!0,this.form.password="",this.$refs.form&&this.$refs.form.clearValidate()},handleCancel(){this.visible=!1,this.$emit("cancel")},handleSubmit(e){e.preventDefault(),this.$refs.form.validate(s=>{s&&(this.loading=!0,this.$emit("submit",this.form.password,()=>{this.loading=!1,this.visible=!1}))})}}};var d=function(){var s=this,a=s._self._c;return a("el-dialog",{attrs:{visible:s.visible,title:"相册密码验证",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){s.visible=t}}},[a("div",{staticClass:"password-dialog"},[a("div",{staticClass:"dialog-icon"},[a("i",{staticClass:"fas fa-lock"})]),a("p",{staticClass:"dialog-tip"},[s._v("这是一个加密相册，请输入密码访问")]),a("el-form",{ref:"form",attrs:{model:s.form,rules:s.rules},nativeOn:{submit:function(t){return t.preventDefault(),s.handleSubmit.apply(null,arguments)}}},[a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入相册密码"},model:{value:s.form.password,callback:function(t){s.$set(s.form,"password",t)},expression:"form.password"}},[a("template",{slot:"prefix"},[a("i",{staticClass:"fas fa-key"})])],2)],1)],1),a("div",{staticClass:"dialog-footer"},[a("el-button",{on:{click:s.handleCancel}},[s._v("返回")]),a("el-button",{attrs:{type:"primary",loading:s.loading},on:{click:s.handleSubmit}},[s._v(" 确认 ")])],1)],1)])},m=[],u=i(c,d,m,!1,null,"33569a6e");const v=u.exports,f={name:"AlbumDetail",components:{AlbumPasswordDialog:v},data(){return{album:{id:this.$route.params.id,name:"",description:"",createTime:"",isLock:0},photos:[],images:[],isAuthenticated:!1,showVideoPreview:!1,currentVideoUrl:""}},mounted(){this.checkAlbumAuth()},methods:{formatDate(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},isVideo(e){if(!e)return!1;const s=[".mp4",".mov",".avi",".wmv",".flv",".webm",".mkv"],a=e.toLowerCase();return s.some(t=>a.includes(t))},previewMedia(e){const s=this.photos[e];this.isVideo(s.url)?this.previewVideo(s.url):this.$refs.imagePreview.show(this.images,e)},previewVideo(e){this.currentVideoUrl=e,this.showVideoPreview=!0,this.$nextTick(()=>{this.$refs.videoPlayer.src=e,this.$refs.videoPlayer.play()})},closeVideoPreview(){this.showVideoPreview=!1,this.$refs.videoPlayer&&(this.$refs.videoPlayer.pause(),this.$refs.videoPlayer.src="")},async checkAlbumAuth(){try{const e=await n(this.album.id);this.album=e.data,this.album.isLock===1?this.$refs.passwordDialog.show():this.getAlbumPhotos()}catch{this.$message.error("获取相册信息失败"),this.$router.push("/photos")}},getAlbumPhotos(){l(this.album.id).then(e=>{this.photos=e.data,this.images=e.data.map(s=>s.url)}).finally(()=>{this.isAuthenticated=!0})},async handlePasswordSubmit(e,s){try{await o(this.album.id,e),this.getAlbumPhotos(),s()}catch(a){this.$message.error(a.message||"密码错误"),this.$refs.passwordDialog.loading=!1}},handlePasswordCancel(){this.$router.push("/photos")}}};var h=function(){var s=this,a=s._self._c;return a("div",{staticClass:"album-detail"},[s.isAuthenticated?a("div",[a("div",{staticClass:"album-header"},[a("div",{staticClass:"header-content"},[a("div",{staticClass:"back-button",on:{click:function(t){return s.$router.back()}}},[a("i",{staticClass:"fas fa-arrow-left"}),a("span",[s._v("返回")])]),a("div",{staticClass:"album-info"},[a("div",{staticClass:"album-meta"},[a("span",{staticClass:"album-date"},[a("i",{staticClass:"fas fa-calendar-alt"}),s._v(" "+s._s(s.formatDate(s.album.createTime))+" ")]),a("span",{staticClass:"album-count"},[a("i",{staticClass:"fas fa-image"}),s._v(" "+s._s(s.photos.length)+" 张照片 ")])]),a("h1",[s._v(s._s(s.album.name))]),a("p",{staticClass:"album-description"},[s._v(s._s(s.album.description))])])]),s._m(0)]),a("div",{staticClass:"photo-container"},[s.photos.length>0?a("div",{staticClass:"photo-grid"},s._l(s.photos,function(t,r){return a("div",{key:t.url,staticClass:"photo-item"},[a("a",{staticClass:"photo-card",attrs:{href:"javascript:;"},on:{click:function(b){return s.previewMedia(r)}}},[s.isVideo(t.url)?s._e():a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.url,expression:"photo.url"}],key:t.url,attrs:{alt:t.description}}),s.isVideo(t.url)?a("video",{staticClass:"video",attrs:{src:t.url}}):s._e(),s.isVideo(t.url)?a("div",{staticClass:"video-badge"},[a("i",{staticClass:"fas fa-play-circle"})]):s._e(),a("div",{staticClass:"photo-overlay"},[a("div",{staticClass:"photo-info"},[a("h3",{staticClass:"photo-description"},[s._v(s._s(t.description))]),a("div",{staticClass:"photo-meta"},[t.recordTime?a("span",{staticClass:"photo-date"},[a("i",{staticClass:"fas fa-calendar"}),s._v(" "+s._s(t.recordTime)+" ")]):s._e(),t.location?a("span",{staticClass:"photo-location"},[a("i",{staticClass:"fas fa-map-marker-alt"}),s._v(" "+s._s(t.location)+" ")]):s._e()])])])])])}),0):a("div",{staticClass:"no-photos"},[a("el-empty",{attrs:{description:"暂无照片"}})],1)]),a("mj-image-preview",{ref:"imagePreview"}),s.showVideoPreview?a("div",{staticClass:"video-preview-overlay",on:{click:s.closeVideoPreview}},[a("div",{staticClass:"video-preview-content",on:{click:function(t){t.stopPropagation()}}},[a("div",{staticClass:"video-preview-header"},[a("button",{staticClass:"video-close-btn",on:{click:s.closeVideoPreview}},[a("i",{staticClass:"fas fa-times"})])]),a("video",{ref:"videoPlayer",attrs:{controls:"",autoplay:""}})])]):s._e()],1):a("div",{staticClass:"loading-container"},[s._m(1)]),a("album-password-dialog",{ref:"passwordDialog",on:{submit:s.handlePasswordSubmit,cancel:s.handlePasswordCancel}})],1)},p=[function(){var e=this,s=e._self._c;return s("div",{staticClass:"header-background"},[s("div",{staticClass:"gradient-overlay"}),s("div",{staticClass:"pattern-overlay"})])},function(){var e=this,s=e._self._c;return s("div",{staticClass:"loading-spinner"},[s("i",{staticClass:"fas fa-spinner fa-spin"})])}],_=i(f,h,p,!1,null,"89ac9b43");const C=_.exports;export{C as default};
