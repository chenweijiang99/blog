import{s as i,n,f as c}from"./index-05qZtuZM.js";import{g as d}from"./dict-Dpqj6rjX.js";function l(s){return i({url:"/api/resource/list",method:"get",params:s})}function u(s){return i({url:"/api/resource/add",method:"post",data:s})}function p(s){return i({url:"/api/resource/verify",method:"get",params:s})}const m={name:"AddResource",props:{visible:{type:Boolean,default:!1},categories:{type:Array,default:()=>[]}},data(){return{uploading:!1,uploadForm:{name:"",category:"",isFree:1,panPath:"",panCode:""},uploadRules:{name:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],category:[{required:!0,message:"请选择资源分类",trigger:"change"}],type:[{required:!0,message:"请选择资源类型",trigger:"change"}],panPath:[{required:!0,message:"请输入网盘地址",trigger:"blur"}],panCode:[{required:!0,message:"请输入提取码",trigger:"blur"}]}}},computed:{dialogVisible:{get(){return this.visible},set(s){this.$emit("update:visible",s)}}},methods:{handleClose(){this.dialogVisible=!1,this.$refs.uploadForm.resetFields()},submitUpload(){this.$refs.uploadForm.validate(s=>{s&&u(this.uploadForm).then(e=>{this.$message.success("资源上传成功，等待博主审核！"),this.$refs.uploadForm.resetFields(),this.handleClose()})})}}};var h=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:"上传资源",visible:e.dialogVisible,width:"500px","custom-class":"upload-dialog"},on:{"update:visible":function(a){e.dialogVisible=a},close:e.handleClose}},[t("el-form",{ref:"uploadForm",attrs:{model:e.uploadForm,rules:e.uploadRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"资源名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入资源名称"},model:{value:e.uploadForm.name,callback:function(a){e.$set(e.uploadForm,"name",a)},expression:"uploadForm.name"}})],1),t("el-form-item",{attrs:{label:"资源分类",prop:"category"}},[t("el-select",{attrs:{placeholder:"请选择分类"},model:{value:e.uploadForm.category,callback:function(a){e.$set(e.uploadForm,"category",a)},expression:"uploadForm.category"}},e._l(e.categories,function(a){return t("el-option",{key:a.id,attrs:{label:a.label,value:a.value}})}),1)],1),t("el-form-item",{attrs:{label:"资源类型",prop:"isFree"}},[t("el-radio-group",{model:{value:e.uploadForm.isFree,callback:function(a){e.$set(e.uploadForm,"isFree",a)},expression:"uploadForm.isFree"}},[t("el-radio",{attrs:{label:1}},[e._v("免费")]),t("el-radio",{attrs:{label:0}},[e._v("付费")])],1)],1),t("el-form-item",{attrs:{label:"网盘地址",prop:"panPath"}},[t("el-input",{attrs:{placeholder:"请输入网盘地址"},model:{value:e.uploadForm.panPath,callback:function(a){e.$set(e.uploadForm,"panPath",a)},expression:"uploadForm.panPath"}})],1),t("el-form-item",{attrs:{label:"提取码",prop:"panCode"}},[t("el-input",{attrs:{placeholder:"请输入提取码"},model:{value:e.uploadForm.panCode,callback:function(a){e.$set(e.uploadForm,"panCode",a)},expression:"uploadForm.panCode"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.uploading},on:{click:e.submitUpload}},[e._v(" 确 定 ")])],1)],1)],1)},v=[],g=n(m,h,v,!1,null,"b67a9436");const f=g.exports,_="/assets/qrcode-uv3RpoFa.jpg",C={name:"ResourcesView",components:{Add:f},data(){return{categoryPages:{},categories:[],uploadDialogVisible:!1,params:{pageNum:1,pageSize:8,category:"",name:""},detailDialogVisible:!1,currentResource:null,showVerifyCode:!1,verifying:!1,verifyForm:{code:""}}},created(){this.getCategory(),this.categories.forEach(s=>{this.$set(this.categoryPages,s.id,1)})},methods:{getCategory(){d("sys_resource_category").then(s=>{this.categories=s.data,this.getResources()})},getResources(){this.categories.forEach(s=>{this.params.category=s.value,l(this.params).then(e=>{this.$set(s,"resources",e.data.records),this.$set(s,"total",e.data.total)})})},formatTime(s){return c(s)},handleSearch(){this.params.pageNum=1,this.getResources()},handlePageChange(s,e){this.$set(this.categoryPages,e.id,s),this.params.category=e.value,this.params.pageNum=s,l(this.params).then(t=>{this.$set(e,"resources",t.data.records),this.$set(e,"total",t.data.total)})},handleResourceClick(s){var e;this.currentResource={...s,categoryIcon:(e=this.categories.find(t=>t.value===s.category))==null?void 0:e.remark},this.detailDialogVisible=!0},showUploadDialog(){if(!this.$store.state.userInfo){this.$message.warning("请先登录");return}this.uploadDialogVisible=!0},handleGetLink(){if(!this.$store.state.userInfo){this.$message.warning("请先登录");return}this.showVerifyCode=!0},handleVerify(){if(!this.verifyForm.code){this.$message.warning("请输入验证码");return}this.verifying=!0,this.verifyForm.id=this.currentResource.id,p(this.verifyForm).then(s=>{this.currentResource.panPath=s.data.panPath,this.currentResource.panCode=s.data.panCode,this.verifying=!1}).catch(s=>{this.$message.error(s.message)}).finally(()=>{this.verifying=!1})},copyText(s){navigator.clipboard.writeText(s).then(()=>{this.$message.success("复制成功")}).catch(()=>{this.$message.error("复制失败")})},handleCloseDetail(){this.detailDialogVisible=!1,this.showVerifyCode=!1,this.qrCodeUrl="",this.verifyForm.code="",this.downloadInfo={link:"",code:""}}}};var b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"resources-container"},[t("div",{staticClass:"page-header"},[e._m(0),t("div",{staticClass:"header-right"},[t("div",{staticClass:"search-bar"},[t("el-input",{attrs:{placeholder:"搜索你感兴趣的资源,按回车键搜索...","prefix-icon":"el-icon-search",clearable:""},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.params.name,callback:function(a){e.$set(e.params,"name",a)},expression:"params.name"}})],1),t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:e.showUploadDialog}},[e._v(" 上传资源 ")])],1)]),e._l(e.categories,function(a){var o;return((o=a.resources)==null?void 0:o.length)>0?t("div",{key:a.id,staticClass:"category-section"},[t("div",{staticClass:"category-header"},[t("div",{staticClass:"category-title"},[t("svg-icon",{attrs:{"icon-class":a.remark}}),t("h2",[e._v(e._s(a.label))])],1)]),t("div",{staticClass:"resources-grid"},e._l(a.resources,function(r){return t("div",{key:r.id,staticClass:"resource-card",on:{click:function(k){return e.handleResourceClick(r)}}},[t("div",{staticClass:"resource-content"},[t("div",{staticClass:"resource-icon"},[t("svg-icon",{attrs:{"icon-class":a.remark}})],1),t("div",{staticClass:"resource-info"},[t("div",{staticClass:"resource-name text-ellipsis",attrs:{title:r.name}},[e._v(e._s(r.name))]),t("div",{staticClass:"resource-meta"},[t("el-tag",{attrs:{size:"mini",type:r.isFree?"warning":"success",effect:"plain"}},[e._v(" "+e._s(r.isFree?"付费":"免费")+" ")])],1)])]),t("div",{staticClass:"resource-footer"},[t("div",{staticClass:"resource-uploader text-ellipsis"},[t("img",{staticClass:"uploader-avatar",attrs:{src:r.avatar}}),t("span",{staticClass:"uploader-name"},[e._v(e._s(r.nickname))])]),t("div",{staticClass:"resource-stats"},[t("span",{staticClass:"upload-time"},[t("i",{staticClass:"el-icon-time"}),e._v(" "+e._s(e.formatTime(r.createTime))+" ")]),t("span",{staticClass:"download-count",attrs:{title:"下载次数"}},[t("i",{staticClass:"el-icon-download"}),e._v(" "+e._s(r.downloads||0)+" ")]),t("span",{staticClass:"view-count",attrs:{title:"浏览次数"}},[t("i",{staticClass:"el-icon-view"}),e._v(" "+e._s(r.views||0)+" ")])])])])}),0),a.total>e.params.pageSize?t("div",{staticClass:"pagination-box"},[t("el-pagination",{attrs:{"current-page":e.categoryPages[a.id],"page-size":e.params.pageSize,layout:"prev, pager, next",total:a.total},on:{"update:currentPage":function(r){return e.$set(e.categoryPages,a.id,r)},"update:current-page":function(r){return e.$set(e.categoryPages,a.id,r)},"current-change":r=>e.handlePageChange(r,a)}})],1):e._e()]):e._e()}),t("Add",{attrs:{visible:e.uploadDialogVisible,categories:e.categories},on:{"update:visible":function(a){e.uploadDialogVisible=a}}}),t("el-dialog",{staticClass:"resource-detail-dialog",attrs:{title:"资源详情",visible:e.detailDialogVisible,width:"600px",top:"5vh","close-on-click-modal":!1},on:{"update:visible":function(a){e.detailDialogVisible=a}}},[e.currentResource?t("div",{staticClass:"resource-detail"},[t("div",{staticClass:"detail-header"},[t("div",{staticClass:"resource-icon"},[t("svg-icon",{attrs:{"icon-class":e.currentResource.categoryIcon}})],1),t("h3",{staticClass:"resource-title"},[e._v(e._s(e.currentResource.name))]),t("el-tag",{attrs:{size:"small",type:e.currentResource.isFree?"warning":"success",effect:"plain"}},[e._v(" "+e._s(e.currentResource.isFree?"付费":"免费")+" ")])],1),t("el-descriptions",{attrs:{border:""}},[t("el-descriptions-item",{attrs:{label:"上传者"}},[t("div",{staticClass:"uploader-info text-ellipsis"},[t("img",{staticClass:"uploader-avatar",attrs:{src:e.currentResource.avatar}}),t("span",[e._v(e._s(e.currentResource.nickname))])])]),t("el-descriptions-item",{attrs:{label:"上传时间"}},[e._v(e._s(e.formatTime(e.currentResource.createTime)))]),t("el-descriptions-item",{attrs:{label:"下载次数"}},[e._v(e._s(e.currentResource.downloads||0))]),t("el-descriptions-item",{attrs:{label:"资源描述"}},[e._v(e._s(e.currentResource.description||"暂无描述"))])],1),e.showVerifyCode?e._e():t("div",{staticClass:"get-link-section"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleGetLink}},[e._v(" 获取下载链接 ")]),t("p",{staticClass:"tip"},[e._v("点击获取链接后需要扫码验证")])],1),e.showVerifyCode?t("div",{staticClass:"verify-section"},[t("div",{staticClass:"qr-code"},[t("img",{attrs:{src:_,alt:"扫码获取验证码"}}),t("p",{staticClass:"scan-tip"},[e._v("请使用微信扫码关注公众号发送 "),t("span",{staticClass:"code-tip"},[e._v("验证码")]),e._v(" 获取验证码")])]),t("el-form",{staticClass:"verify-form",attrs:{model:e.verifyForm}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入验证码",maxlength:"6"},model:{value:e.verifyForm.code,callback:function(a){e.$set(e.verifyForm,"code",a)},expression:"verifyForm.code"}},[t("template",{slot:"append"},[t("el-button",{attrs:{type:"primary",loading:e.verifying},on:{click:e.handleVerify}},[e._v(" 验证 ")])],1)],2)],1)],1)],1):e._e(),e.currentResource.panPath?t("div",{staticClass:"download-link-section"},[t("div",{staticClass:"link-item"},[t("span",{staticClass:"label"},[e._v("网盘链接:")]),t("el-input",{attrs:{readonly:""},model:{value:e.currentResource.panPath,callback:function(a){e.$set(e.currentResource,"panPath",a)},expression:"currentResource.panPath"}},[t("el-button",{attrs:{slot:"append"},on:{click:function(a){return e.copyText(e.currentResource.panPath)}},slot:"append"},[e._v(" 复制 ")])],1)],1),e.currentResource.panCode?t("div",{staticClass:"link-item"},[t("span",{staticClass:"label"},[e._v("提取码:")]),t("el-input",{attrs:{readonly:""},model:{value:e.currentResource.panCode,callback:function(a){e.$set(e.currentResource,"panCode",a)},expression:"currentResource.panCode"}},[t("el-button",{attrs:{slot:"append"},on:{click:function(a){return e.copyText(e.currentResource.panCode)}},slot:"append"},[e._v(" 复制 ")])],1)],1):e._e()]):e._e()],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCloseDetail}},[e._v("关闭")])],1)])],2)},y=[function(){var s=this,e=s._self._c;return e("div",{staticClass:"header-left"},[e("h1",{staticClass:"page-title"},[s._v("资源中心")])])}],F=n(C,b,y,!1,null,"cb1fc382");const x=F.exports;export{x as default};
