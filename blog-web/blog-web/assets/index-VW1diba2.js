import{n,B as r,C as c,D as o,E as l,F as d,f as u}from"./index-05qZtuZM.js";const f={name:"Notifications",data(){return{currentCategory:"all",categories:[{type:"all",name:"全部消息",icon:"fas fa-bell",unread:0},{type:"system",name:"系统消息",icon:"fas fa-cog",unread:0},{type:"comment",name:"评论消息",icon:"fas fa-comment",unread:0},{type:"like",name:"点赞消息",icon:"fas fa-heart",unread:0},{type:"follow",name:"关注消息",icon:"fas fa-user-plus",unread:0}],notifications:[],params:{pageNum:1,pageSize:10,type:null},total:0,loading:!1}},computed:{currentCategoryName(){const a=this.categories.find(t=>t.type===this.currentCategory);return a?a.name:"全部消息"},filteredNotifications(){return this.currentCategory==="all"?this.notifications:this.notifications.filter(a=>a.type===this.currentCategory)},hasUnread(){return this.filteredNotifications.some(a=>!a.isRead)}},methods:{switchCategory(a){this.currentCategory=a,this.params.type=a==="all"?null:a,this.params.pageNum=1,this.fetchNotifications()},getNotificationIcon(a){const t=this.categories.find(e=>e.type===a);return t?t.icon:"fas fa-bell"},formatTime(a){return u(a)},handleArticleClick(a){this.$router.push(`/post/${a}`)},updateUnreadCount(a){this.categories.forEach(t=>{if(a){t.unread=0;return}t.type==="all"?t.unread=this.notifications.filter(e=>!e.isRead).length:t.unread=this.notifications.filter(e=>e.type===t.type&&!e.isRead).length})},async fetchNotifications(){this.loading=!0;try{const{data:a}=await d(this.params);this.notifications=a.records,this.total=a.total}catch{this.$message.error("获取消息通知失败")}finally{this.loading=!1}},handlePageChange(a){this.params.pageNum=a,this.fetchNotifications()},async markAllAsRead(){try{await l(),this.fetchNotifications(),this.updateUnreadCount(!0),this.$message.success("已将所有消息标记为已读")}catch{this.$message.error("操作失败")}},async handleNotificationClick(a){if(!a.isRead)try{await o(a.id),a.isRead=!0,this.updateUnreadCount()}catch{this.$message.error("标记已读失败")}},async deleteNotification(a){this.$confirm("确定要删除这条消息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await c(a),this.updateUnreadCount(),this.$message.success("删除成功")}catch{this.$message.error("删除失败")}}).catch(()=>{})},async getUnreadNotificationsCount(){const{data:a}=await r();let t=0;this.categories.forEach(e=>{var s;e.type!=="all"&&(e.unread=((s=a[e.type])==null?void 0:s.num)||0,t+=e.unread)}),this.categories.find(e=>e.type==="all").unread=t}},created(){if(!this.$store.state.userInfo){this.$router.push("/login");return}this.fetchNotifications(),this.getUnreadNotificationsCount()}};var h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notifications-page"},[e("div",{staticClass:"notifications-sidebar"},[t._m(0),e("div",{staticClass:"category-list"},t._l(t.categories,function(s){return e("div",{key:s.type,staticClass:"category-item",class:{active:t.currentCategory===s.type},on:{click:function(i){return t.switchCategory(s.type)}}},[e("i",{class:s.icon}),e("span",[t._v(t._s(s.name))]),s.unread?e("el-badge",{staticClass:"category-badge",attrs:{value:s.unread}}):t._e()],1)}),0)]),e("div",{staticClass:"notifications-main"},[e("div",{staticClass:"notifications-header"},[e("h1",[t._v(t._s(t.currentCategoryName))]),e("div",{staticClass:"header-actions"},[t.hasUnread?e("el-button",{attrs:{type:"text"},on:{click:t.markAllAsRead}},[e("i",{staticClass:"fas fa-check-double"}),t._v(" 全部已读 ")]):t._e()],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"notifications-content"},[t.notifications.length?[t._l(t.filteredNotifications,function(s){return e("div",{key:s.id,staticClass:"notification-item",class:{unread:!s.isRead},on:{click:function(i){return t.handleNotificationClick(s)}}},[e("div",{staticClass:"notification-icon"},[e("i",{class:t.getNotificationIcon(s.type)})]),e("div",{staticClass:"notification-body"},[e("div",{staticClass:"notification-title"},[t._v(t._s(s.title))]),e("div",{staticClass:"notification-message"},[s.type==="comment"?e("span",[s.fromUserId?e("span",[t._v(" "+t._s(s.fromNickname)+" 回复了你在 "),e("span",{staticClass:"article-title",on:{click:function(i){return t.handleArticleClick(s.articleId)}}},[t._v(t._s(s.articleTitle))]),t._v(" 中的评论 ")]):e("span",[t._v(" "+t._s(s.fromNickname)+" 评论了你的文章 ")]),e("div",{domProps:{innerHTML:t._s(s.message)}})]):t._e(),s.type==="like"?e("span",[t._v(" "+t._s(s.toNickname)+" 点赞了你的 "),e("span",{staticClass:"article-title",on:{click:function(i){return t.handleArticleClick(s.articleId)}}},[t._v(t._s(s.articleTitle))]),t._v(" 文章 ")]):t._e(),s.type==="follow"?e("span",[t._v(" "+t._s(s.fromNickname)+" 关注了你 ")]):t._e(),s.type==="system"?e("span",[t._v(" "+t._s(s.message)+" ")]):t._e()]),e("div",{staticClass:"notification-time"},[t._v(t._s(t.formatTime(s.createTime)))])]),e("div",{staticClass:"notification-actions"},[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return i.stopPropagation(),t.deleteNotification(s.id)}}},[e("i",{staticClass:"fas fa-trash-alt"})])],1)])}),e("div",{staticClass:"pagination-box"},[t.notifications.length?e("el-pagination",{attrs:{background:"","current-page":t.params.pageNum,"page-size":t.params.pageSize,layout:"prev, pager, next",total:t.total},on:{"current-change":t.handlePageChange}}):t._e()],1)]:e("div",{staticClass:"empty-state"},[e("i",{staticClass:"fas fa-bell-slash"}),e("p",[t._v("暂无"+t._s(t.currentCategoryName))])])],2)])])},m=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"sidebar-header"},[t("h2",[a._v("消息分类")])])}],p=n(f,h,m,!1,null,"492d3cef");const _=p.exports;export{_ as default};
